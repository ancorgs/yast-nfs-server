/**
 * File:
 *   nfs_server.ycp
 *
 * Module:
 *   Configuration of nfs_server
 *
 * Summary:
 *   Module for the configuration of the nfs server
 *
 * Authors:
 *   Jan Holesovsky <kendy@suse.cz>
 *   Dan Vesely <dan@suse.cz>
 *   Martin Vidner <mvidner@suse.cz>
 *
 * $Id$
 *
 * Module for the configuration of the nfs server
 */

/***
 * <h3>Configuration of the nfs_server</h3>
 */

{

    textdomain "nfs_server";

    import "NfsServer";
    // TODO also apply to autoyast part,
    // must be able to query packages in selections
    import "Require";
    import "Wizard";
    import "Popup";
    include "wizard/sequencer.ycp";
    include "nfs_server/ui.ycp";

    map Aliases = $[
	"begin"   : ``(BeginDialog ()),
	"exports"   : ``(ExportsDialog ()),
	];

    map Sequence = $[
	"ws_start"  : "begin",
	"begin"     : $[
	    `next   : "exports",
	    `finish : `ws_finish,
	    `abort  : `abort
	    ],
	"exports"       : $[
	    `next   : `ws_finish,
	    `abort  : `abort
	    ],
	];

    // If nfs-utils nor nfs-server is not installed, install nfs-utils.
    // TODO: require installation of alternate packages
    if (!Require::IsPackageInstalledTarget ("nfs-server"))
    {
	use_star_for_anonymous = true;
	spaces_allowed = true;
	if (!Require::RequireAndConflictTarget (NfsServer::required_packages, [],
			     // notification 1/2
			     _("<p>To configure the Network File System, the <b>%1</b> package must be installed.</p>") +
			     // notification 2/2
			     _("<p>Do you want to install it now?</p>")))
	{
	    return nil;
	}
    }

    if (! NfsServer::Read ())
    {
	// TODO:log an error?
	return nil;
    }

    Wizard::CreateDialog ();

    any result = WizardSequencer (Aliases, Sequence);

    if (result == `ws_finish)
    {
	NfsServer::Write();
    }

    return UI::CloseDialog();
}
